Omnidirectional Simultaneous Localisation and Mapping via Stereo Vision (2020) - Durham University
Authors: Kaiwen Lin & Jasper Meyer
Supervised by: Prof. Toby Breckon
Date: 24 April 2020
Contacts:
	  meyerjasper@gmail.com

############################# Introduction #####################################

The first development of this program was part of a Final Year Project by Kaiwen Lin at Durham University. 
The research project was to implement a omnidirectional stereo system based upon two Ricoh Theta S Cameras set up in a top-bottom topology. 
The program has been advanced by a second Final Year Project by Jasper Meyer at Durham University where the objective was to improve 
the fidelity to ground truth of the Stereo Vision algorithm, add Odometry capabilities to the software and combine both into 
an omni-directional SLAM output.

It is used to:
  - Generate Images for Omnidirectional Stereo Calibration
  - Calibrate Omnidirectional Stereo Rig
  - Compute Disparity Map and Point Clouds
  - Compute Odometry Data
  - Combine the Point Clouds and Odometry Data into a SLAM output
  - Log All Data Generated

############################# Requirements ####################################

- Ubuntu 18.04.1
- OpenCV 3.1.0 (with ccalib)
- PCL 1.3
- Eigen3 3.3.4
- Open3D 0.9 (For point cloud visualisation in Python)
- C++14
- OpenMP
- 2 Ricoh Theta S Cameras (Run in Live Mode) connected on the same USB peripheral
- Yoctopuce GPS Drivers

############################ Build and Run ####################################

To Build (in the main directory):
$ make

To Run:
$ cd bin
$ ./omnidir_stereo [Flags based on wanted configuration below]

Configurations:
  # To Take Calibration Images #:
  $ ./omnidir_stereo -g [-i <img_dir>]

    -g: generate images
    -i: image directory

  # To Calibrate System #:
  $ ./omnidir_stereo -c [-i <img_dir>] [-p <save_dir>] -w <board_width> -h <board_height>
                   -sw <square_width> -sh <square_height> [-fs] [-fp] [-m]

    -c: calibrate system
    -p: parameter save directory
    -w: width of board (number of inner corners)
    -h: height of board (number of inner corners)
    -sw: square width size [in mm]
    -sh: square height size [in mm]
    -fp: fix principal point (i.e. use image center)
    -fs: fix skew (i.e. no skew)
    -m: manual check of automatic detected corners

  # Stream Real Time Disparity Map #:
  $ ./omnidir_stereo -s [-p <save_dir>] [-pc] [-export] [-fps]

    -pc: point cloud generation and concatenation into an omnidirectional point cloud
    -o: odometry estimation. When -pc and -o are both set, the odometry data is included in the point 		cloud concatenation
    -fps: log frame rate (inc. time taken for sgbm) [in ms]
    -export: export merged video (raw, undistorted, disparity map)

    This configuration shows a real-time HSV disparity map, a concatenation of point clouds updated 	in real time, and the egomotion estimation for the current dataset with optional options
    to generate point clouds, save real-time disparity map and log frame rate.
    This map is either from a live feed, or a psuedo-live feed generated by the
    log data configuration.

    The SPS parameters can be dynamically configured using:
      ([Parameter]: [up]/[down])
      Number of outer Iterations: q/a
      Number of inner Iterations: w/s
      Position Weight: e/d
      Depth Weight: r/f
      Boundary Length Weight: t/g
      Smoothness Weight: y/h
      Inlier Threshold: u/j
      Hinge Penalty Value: i/k
      Occlusion Penalty Value: o/l
      Impossible Penalty Value: p/;
      Print All Parameters: z

    * Accurate frame rate logging may require switching of some other logging
      features in the program. FPS data is overwritten each time the program is
      run.

  # Log Data #:
  $ ./omnidir_stereo -s -l [-gps]

    -l: log data (record and save raw video stream)
    -gps: gps tracking on

    The log data configuration is used to save video and gps data used for
    further offline analysis. In particular, the stored raw footage of cameras can be used
    as a psuedo-live stream to the "Stream Real Time Disparity Map" Conifguration.

################################ Notes ########################################

Do not change the file structure as the program will not work.
Any other queries, feel free to contact Kaiwen for Omnidirectional Stereo and SGBM Stereo Matching, and Jasper for SPS smoothing, Odometry and Point Cloud concatenation.
